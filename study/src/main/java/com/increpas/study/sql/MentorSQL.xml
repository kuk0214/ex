<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybaits.org/DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
<mapper namespace="mtSQL">
	
	<!-- 멘토 리스트 보기 질의명령 -->
	<select id="mentorList" resultType="mtVO" parameterType="page">
 	 	SELECT
		    rno, no, subject, title, pr, mtid, wdate, sysdate
		FROM
		    (
		        SELECT
		            ROWNUM rno, no, subject, title, pr, mtid , wdate, sysdate
		        FROM
		            (
		                SELECT
		                    no, subject, title, pr, mentorid mtid, wdate, sysdate
		                FROM
		                    mentor
		                WHERE
		                    isShow = 'Y'
	                    <choose>
	                    	<when test="option neq null and option eq 'subject'">
	                    		AND subject LIKE '%' ||#{keyword}|| '%'
	                    	</when>
	                    	<when test="option eq 'title'">
	                    		AND title LIKE '%' ||#{keyword}|| '%'
	                    	</when>
	                    	<when test="option eq 'mtid'">
	                    		AND mentorid LIKE '%' ||#{keyword}|| '%'
	                    	</when>
	                    </choose>
		                ORDER BY
		                    wdate DESC
		            )
		    )
		WHERE
		    rno BETWEEN #{startCont} AND #{endCont}
 	</select>
 	 
 	<!-- 등록된 멘토 총 수 조회 질의명령 -->
 	<select id="getTotal" resultType="int">
 		SELECT
 			COUNT(*)
		FROM
			mentor
		WHERE
			isShow = 'Y'
 	</select>
	
	<!-- 멘토 소개 등록 질의명령 -->
	<insert id="mentorWriteProc" parameterType="mtVO">
		INSERT INTO
		    mentor(no, mentorid, subject, title, pr)
		VALUES(
		    (SELECT NVL(MAX(no) + 1, 1001) FROM mentor),
		    #{mtid}, #{subject}, #{title}, #{pr}
		)
	</insert>
	
	<!-- 멘토 회원 확인 질의명령 -->
	<select id="mentorCheck" resultType="int">
		SELECT
			COUNT(*)
		FROM
			member
		WHERE
			id = #{sid}
			AND grade = '멘토'
	</select>
	
	<!-- 멘토 자기소개 보기 질의명령 -->
	<select id="mentorPr" resultType="mtVO" parameterType="int">
		SELECT
			name, pr
		FROM	
			member m, mentor mt
		WHERE
			id = mentorid
			AND mt.isShow = 'Y'
			AND no = #{no}	 
	</select>
	
</mapper>